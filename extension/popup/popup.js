!function(){"use strict";const e={actualMode:"autocomplete"},t=["logs","title","cursor","typing","mouseover","infinite","timeout","history","includeImages"],o=document.querySelector("#mode").querySelectorAll("button"),n=["includeImages"],s={autocomplete:[],clipboard:["typing","mouseover"],"question-to-answer":["typing","infinite","mouseover"]};function r(){const o=s[e.actualMode],r=t.filter((e=>!o.includes(e)&&!n.includes(e)));for(const e of o)document.querySelector("#"+e).parentElement.style.display="none";for(const e of r)document.querySelector("#"+e).parentElement.style.display=""}for(const t of o)t.addEventListener("click",(function(){const n=t.value;e.actualMode=n;for(const e of o)e.value!==n?e.classList.add("not-selected"):e.classList.remove("not-selected");r()}));const c="1.1.5",a=document.querySelector("#version");function i(e,t=!0){if(t)return void(a.textContent="v"+e);const o=document.createElement("a");o.href="https://github.com/marveljo25/MoodleGPT-free",o.rel="noopener noreferrer",o.target="_blank",o.textContent="v"+e,a.appendChild(o),a.appendChild(document.createTextNode(" is now available !"))}!async function(){const e=await async function(){const e=await fetch("https://raw.githubusercontent.com/yoannchb-pro/MoodleGPT/main/package.json");return(await e.json()).version}().catch((e=>(console.error(e),c))),t=e.split("."),o=c.split("."),n=Math.min(t.length,o.length);for(let s=0;s<n;++s){if(parseInt(t[s])>parseInt(o[s]))return i(e,!1);if(parseInt(o[s])>parseInt(t[s]))return i(c)}i(c)}();const l=document.querySelector("#settings"),u=document.querySelector("#advanced-settings"),d=document.querySelector("#switch-settings");function m({msg:e,isError:t,isInfinite:o}){const n=document.querySelector("#message");n.style.color=t?"red":"limegreen",n.textContent=e,n.style.display="block",o||setTimeout((()=>n.style.display="none"),5e3)}function y(e){return e.replace(/\s+/g," ").trim()}d.addEventListener("click",(function(e){e.preventDefault(),"flex"===u.style.display?(l.style.display="flex",u.style.display="none",d.textContent="Advanced settings"):(l.style.display="none",u.style.display="flex",d.textContent="Go back to settings")}));const p=document.querySelector(".save"),f=document.querySelector("#check-model");if(!p)throw new Error("Save button not found");if(!f)throw new Error("Test button not found");const g=["apiKey","code","baseURL","maxTokens"];p.addEventListener("click",(()=>{const o=g.map((e=>{const t=document.querySelector("#"+e);if(!t)throw new Error(`Input #${e} not found`);return t.value.trim()})),[n,s,r,c]=o,a=t.map((e=>{const t=document.querySelector("#"+e);if(!t)throw new Error(`Checkbox #${e} not found`);return t.checked&&"none"!==t.parentElement?.style.display})),[i,l,u,d,y,p,f,h,v]=a;n?s.length>0&&s.length<2?m({msg:"The code should at least contain 2 characters",isError:!0}):(chrome.storage.sync.set({moodleGPT:{apiKey:n,code:s,baseURL:r,maxTokens:c?parseInt(c):void 0,logs:i,title:l,cursor:u,typing:d,mouseover:y,infinite:p,timeout:f,history:h,includeImages:v,mode:e.actualMode,model:"qwen/qwen2.5-vl-72b-instruct:free"}}),m({msg:"Configuration saved"})):m({msg:"Please complete all the form",isError:!0})})),chrome.storage.sync.get(["moodleGPT"]).then((o=>{const n=o.moodleGPT;n&&(n.mode&&(e.actualMode=n.mode),g.forEach((e=>{const t=document.querySelector("#"+e);t&&n[e]&&(t.value=n[e])})),t.forEach((e=>{const t=document.querySelector("#"+e);t&&(t.checked=n[e]||!1)})),r())})),f.addEventListener("click",(async()=>{chrome.storage.sync.get(["moodleGPT"]).then((async e=>{const t=e.moodleGPT;if(t&&t.apiKey)try{console.log("Testing OpenRouter API with Qwen model...",t.apiKey);m({msg:"Test successful: "+(await async function(e,t){const o=new AbortController,n=setTimeout((()=>o.abort()),2e4),s=[{type:"text",text:t}],r=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${e.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:"qwen/qwen2.5-vl-72b-instruct:free",messages:[{role:"user",content:s}],max_tokens:e.maxTokens||200}),signal:e.timeout?o.signal:null});if(clearTimeout(n),!r.ok)throw new Error(`OpenRouter API error ${r.status}: ${await r.text()}`);const c=await r.json(),a=c.choices?.[0]?.message?.content??JSON.stringify(c);return{question:t,response:a,normalizedResponse:y(a)}}({apiKey:t.apiKey,maxTokens:50},"Hello Qwen, test your response!")).response})}catch(e){m({msg:"Test failed: "+e.message,isError:!0})}else m({msg:"API key not set",isError:!0})}))}))}();
//# sourceMappingURL=popup.js.map
