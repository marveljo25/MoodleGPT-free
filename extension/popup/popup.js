!function(){"use strict";const e={actualMode:"autocomplete"},t=["logs","title","cursor","timeout","typing","mouseover","infinite","history","includeImages"],o=[...t,"useReasoning"],n=document.querySelector("#mode").querySelectorAll("button"),s=["includeImages"],r={autocomplete:[],clipboard:["typing","mouseover"],"question-to-answer":["typing","infinite","mouseover"]};function i(){const o=r[e.actualMode],n=t.filter((e=>!o.includes(e)&&!s.includes(e)));for(const e of o)document.querySelector("#"+e).parentElement.style.display="none";for(const e of n)document.querySelector("#"+e).parentElement.style.display=""}for(const t of n)t.addEventListener("click",(function(){const o=t.value;e.actualMode=o;for(const e of n)e.value!==o?e.classList.add("not-selected"):e.classList.remove("not-selected");i()}));const c="1.1.5",a=document.querySelector("#version");function l(e,t=!0){if(t)return void(a.textContent="v"+e);const o=document.createElement("a");o.href="https://github.com/marveljo25/MoodleGPT-free",o.rel="noopener noreferrer",o.target="_blank",o.textContent="v"+e,a.appendChild(o),a.appendChild(document.createTextNode(" is now available !"))}!async function(){const e=await async function(){const e=await fetch("https://raw.githubusercontent.com/yoannchb-pro/MoodleGPT/main/package.json");return(await e.json()).version}().catch((e=>(console.error(e),c))),t=e.split("."),o=c.split("."),n=Math.min(t.length,o.length);for(let s=0;s<n;++s){if(parseInt(t[s])>parseInt(o[s]))return l(e,!1);if(parseInt(o[s])>parseInt(t[s]))return l(c)}l(c)}();const d=document.querySelector("#settings"),u=document.querySelector("#advanced-settings"),m=document.querySelector("#switch-settings");function p({msg:e,isError:t,isInfinite:o}){const n=document.querySelector("#message");n.style.color=t?"red":"limegreen",n.textContent=e,n.style.display="block",o||setTimeout((()=>n.style.display="none"),5e3)}function f(e,t=!0){t&&(e=e.toLowerCase());return e.replace(/\n+/gi,"\n").replace(/(\n\s*\n)+/g,"\n").replace(/[ \t]+/gi," ").trim().replace(/^[a-z\d]\.\s/gi,"").replace(/\n[a-z\d]\.\s/gi,"\n")}m.addEventListener("click",(function(e){e.preventDefault(),"flex"===u.style.display?(d.style.display="flex",u.style.display="none",m.textContent="Advanced settings"):(d.style.display="none",u.style.display="flex",m.textContent="Go back to settings")}));const y=document.querySelector(".save"),g=document.querySelector("#check-model");if(!y)throw new Error("Save button not found");if(!g)throw new Error("Test button not found");const h=["apiKey","model","code","baseURL","maxTokens"];if(!document.querySelector("#includeImages"))throw new Error("Checkbox #includeImages not found");y.addEventListener("click",(async()=>{const t=h.map((e=>{const t=document.querySelector("#"+e);if(!t)throw new Error(`Input #${e} not found`);return t.value.trim()})),[n,s,r,i,c]=t,a=document.querySelector("#includeImages");if(!a)throw new Error("Include Images checkbox not found");if(!n||!s||!r)return void p({msg:"Please complete required fields: Api Key, GPT Model and Code",isError:!0});let l=!1;try{const S=await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${n}`}});if(S.ok){const q=await S.json();function T(e){return e?e.toLowerCase().replace(/:free$/,""):""}const x=q.data?.find((e=>T(e.id).includes(T(s))||T(e.hugging_face_id).includes(T(s))));l=x?.architecture?.input_modalities?.includes("image")??!1,console.log("Model info:",x),console.log("Supports image:",l)}}catch(I){console.warn("Failed to check model capabilities:",I)}l?a.disabled=!1:(a.checked=!1,a.disabled=!0,p({msg:`Model "${s}" does not support image input.`,isError:!1}));const d=o.map((e=>{const t=document.querySelector("#"+e);if(!t)throw new Error(`Checkbox #${e} not found`);return t.checked&&"none"!==t.parentElement?.style.display})),[u,m,f,y,g,v,w,b,k,E]=d;chrome.storage.sync.set({moodleGPT:{apiKey:n,code:r,baseURL:i,maxTokens:c?parseInt(c):void 0,logs:u,title:m,cursor:f,typing:g,mouseover:v,infinite:w,timeout:y,history:b,includeImages:k,useReasoning:E,mode:e.actualMode,model:s}}),p({msg:"Configuration saved"})})),chrome.storage.sync.get(["moodleGPT"]).then((t=>{const n=t.moodleGPT;n&&(n.mode&&(e.actualMode=n.mode),h.forEach((e=>{const t=document.querySelector("#"+e);t&&n[e]&&(t.value=n[e])})),o.forEach((e=>{const t=document.querySelector("#"+e);t&&(t.checked=n[e]||!1)})),i())})),g.addEventListener("click",(async()=>{chrome.storage.sync.get(["moodleGPT"]).then((async e=>{const t=e.moodleGPT;if(t&&t.apiKey)if(t.model)if(t.code)try{p({msg:"Test successful: "+(await async function(e,t){const o=new AbortController,n=setTimeout((()=>o.abort()),2e4);let s;s={messages:[{role:"user",content:t}]};const r=`${e.baseURL&&""!==e.baseURL.trim()?e.baseURL.replace(/\/+$/,""):"https://openrouter.ai"}/api/v1/chat/completions`,i=[...s.messages],c=await fetch(r,{method:"POST",headers:{Authorization:`Bearer ${e.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:e.model,messages:i,max_tokens:e.maxTokens||200}),signal:e.timeout?o.signal:null});if(clearTimeout(n),!c.ok)throw new Error(`OpenRouter API error ${c.status}: ${await c.text()}`);const a=await c.json(),l=a.choices?.[0]?.message?.content??JSON.stringify(a);return"saveResponse"in s&&"function"==typeof s.saveResponse&&s.saveResponse(l),{question:t,response:l,normalizedResponse:f(l)}}({apiKey:t.apiKey,model:t.model,maxTokens:50,useReasoning:t.useReasoning},"Hello, what is your model?")).response})}catch(e){p({msg:"Test failed: "+e.message,isError:!0})}else p({msg:"Code not set (required)",isError:!0});else p({msg:"Model not set",isError:!0});else p({msg:"API key not set",isError:!0})}))}))}();
//# sourceMappingURL=popup.js.map
